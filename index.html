<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subway Surfers by Mynvo - Ã‰dition 2025 ComplÃ¨te</title>
  <meta name="description" content="Jouez Ã  Subway Surfers 2025 version Mynvo avec tous les personnages dÃ©bloquÃ©s, ZQSD, Timer, FPS et plus encore!">
  <style>
    /* VOTRE CSS EXISTANT - 1800 LIGNES */
    :root {
      --primary: #7c62dc;
      --primary-dark: #6a50c9;
      --primary-light: #9580e8;
      --primary-transparent: rgba(124, 98, 220, 0.15);
      --bg-dark: #0a0a0a;
      --bg-card: rgba(30, 30, 40, 0.8);
      --text-light: #f0f0f0;
      --text-muted: #aaa;
      --success: #00cc66;
      --danger: #ff4444;
      --warning: #ffaa00;
    }
    
    /* TOUS VOS STYLES EXISTANTS... */
  </style>
</head>
<body class="theme-violet">
  <!-- Particules d'arriÃ¨re-plan -->
  <div class="particles" id="particles-container"></div>

  <header>
    <div class="header-content">
      <div class="logo">
        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjUwIiBoZWlnaHQ9IjUwIiByeD0iMjUiIGZpbGw9IiM3QzYyREMiLz4KPHBhdGggZD0iTTE1IDM1TDM1IDM1TDM1IDMwTDE1IDMwTDE1IDM1WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE1IDI1TDM1IDI1TDM1IDIwTDE1IDIwTDE1IDI1WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE1IDE1TDM1IDE1TDM1IDEwTDE1IDEwTDE1IDE1WiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+" alt="Mynvo">
        Subway<span>Surfers</span> by <span>Mynvo</span>
      </div>
      <div class="nav-links">
        <a id="play-link">Jouer</a>
        <a id="settings-link">ParamÃ¨tres</a>
        <a href="https://discord.gg/bQTtDXmF" target="_blank">Discord</a>
      </div>
    </div>
  </header>

  <main>
    <div class="game-container">
      <div class="game-frame">
        <div class="loading" id="loading-ui">
          <div class="spinner"></div>
          <p>Chargement du jeu Subway Surfers 2025...</p>
        </div>
        <button class="fs-button" id="fs-btn" title="Plein Ã©cran">â¤¢ Plein Ã©cran</button>
        <iframe id="game-iframe" src="./game/index.html" allowfullscreen allow="autoplay; fullscreen *"></iframe>
      </div>
    </div>
  </main>

  <!-- FPS Counter -->
  <div id="fps-overlay">ğŸ® FPS: <span id="fps-value">60</span></div>

  <!-- TOP 3 -->
  <div id="top3-overlay">
    <div class="title">ğŸ† TOP 3 NO COIN</div>
    <div class="player first">ğŸ¥‡ Mynvo â€“ 13:27</div>
    <div class="player">ğŸ¥ˆ Le_A â€“ 11:51</div>
    <div class="player">ğŸ¥‰ Dimitri â€“ 8:12</div>
  </div>

  <!-- Timer Speedrun -->
  <div id="speedrun-timer-overlay">
    <div id="timer-display">00:00.00</div>
  </div>

  <!-- Bottom Menu -->
  <div id="bottom-menu">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <div style="font-size:16px;font-weight:700;color:var(--primary);">âš™ï¸ Menu rapide</div>
      <button id="close-bottom-menu" style="background:var(--primary);border:none;color:#000;font-weight:700;border-radius:8px;padding:4px 10px;cursor:pointer;">âœ–</button>
    </div>

    <button class="quick-btn" id="settings-quick-btn">ğŸ® Configuration complÃ¨te</button>
    <button class="quick-btn" id="timer-quick-btn">â±ï¸ Timer Speedrun</button>
    <button class="quick-btn" id="fps-quick-btn">ğŸ“Š FPS (afficher/masquer)</button>
    <button class="quick-btn" id="fullscreen-quick-btn">â¤¢ Plein Ã©cran</button>
    <button class="quick-btn" id="top3-quick-btn">ğŸ† TOP 3 (afficher/masquer)</button>
    <button class="quick-btn give-piece-btn" id="unlock-all-btn">ğŸ”“ DÃ©bloquer Tout (100%)</button>
  </div>

  <footer>Subway Surfers 2025 by Mynvo Â© 2025 - Tous droits rÃ©servÃ©s</footer>

  <script>
  console.log('%c[MYNVO] SystÃ¨me d\'extension intÃ©grÃ© activÃ©!', 'color: #7c62dc; font-weight: bold; font-size: 14px;');

// ============= CONFIGURATION AMÃ‰LIORÃ‰E =============
let config = {
  customKeys: {
    up: "z",
    down: "s", 
    left: "q",
    right: "d",
    hoverboard: " "
  },
  timerStartKey: "t",
  timerPauseKey: " ",
  timerResetKey: "r",
  showFPS: true,
  showTop3: true,
  showTimer: false,
  fullscreenKeepOverlays: true,
  theme: "violet",
  overlaySizes: {
    fps: 1.0,
    top3: 1.0,
    timer: 1.0
  },
  overlayPositions: {
    fps: { top: "100px", left: "20px" },
    top3: { bottom: "20px", left: "20px" },
    timer: { top: "20px", right: "20px" }
  }
};

// ============= VARIABLES GLOBALES =============
const iframe = document.getElementById('game-iframe');
const loadingUI = document.getElementById('loading-ui');
const timerOverlay = document.getElementById('speedrun-timer-overlay');
const timerDisplay = document.getElementById('timer-display');

let zqsdActive = true;
let isSettingKey = false;
let currentKeySetting = null;
let isDragging = false;
let currentDraggedElement = null;
let dragOffset = { x: 0, y: 0 };

// Variables Timer
let timerState = 'stopped';
let timerStartTime = null;
let timerCurrentTime = 0;
let timerInterval = null;
let timerVisible = false;

// ============= CHARGEMENT DE LA PAGE =============
iframe.addEventListener('load', function() {
  console.log('âœ… Iframe chargÃ©e');
  hideLoading();
  setTimeout(initializeExtensionFeatures, 1500);
});

setTimeout(function() {
  if (loadingUI.style.display !== 'none') {
    hideLoading();
    showNotification('ğŸ® Jeu chargÃ©! Utilisez ZQSD + ESPACE pour jouer.', 'success', true);
  }
}, 3000);

function hideLoading() {
  if (loadingUI.style.display !== 'none') {
    loadingUI.style.display = 'none';
  }
}

// ============= SYSTÃˆME ZQSD CORRIGÃ‰ =============
function setupZQSDSystem() {
  console.log('ğŸ® Activation du systÃ¨me ZQSD corrigÃ©...');
  
  document.removeEventListener('keydown', handleZQSDKeyDown);
  document.removeEventListener('keyup', handleZQSDKeyUp);
  
  document.addEventListener('keydown', handleZQSDKeyDown, true);
  document.addEventListener('keyup', handleZQSDKeyUp, true);
}

function handleZQSDKeyDown(e) {
  if (!zqsdActive || e.repeat || isSettingKey) return;
  
  const key = e.key.toLowerCase();
  const mappedKey = getKeyMapping(key);
  
  if (mappedKey) {
    e.preventDefault();
    e.stopPropagation();
    e.stopImmediatePropagation();
    
    console.log(`ğŸ® Touche ZQSD: ${key} -> ${mappedKey.key}`);
    dispatchMappedKey(mappedKey, 'keydown');
  }
}

function handleZQSDKeyUp(e) {
  if (!zqsdActive || isSettingKey) return;
  
  const key = e.key.toLowerCase();
  const mappedKey = getKeyMapping(key);
  
  if (mappedKey) {
    e.preventDefault();
    e.stopPropagation();
    e.stopImmediatePropagation();
    
    dispatchMappedKey(mappedKey, 'keyup');
  }
}

function getKeyMapping(key) {
  const keyMap = {
    [config.customKeys.up]: { key: 'ArrowUp', code: 'ArrowUp', keyCode: 38 },
    [config.customKeys.down]: { key: 'ArrowDown', code: 'ArrowDown', keyCode: 40 },
    [config.customKeys.left]: { key: 'ArrowLeft', code: 'ArrowLeft', keyCode: 37 },
    [config.customKeys.right]: { key: 'ArrowRight', code: 'ArrowRight', keyCode: 39 },
    [config.customKeys.hoverboard]: { key: ' ', code: 'Space', keyCode: 32 }
  };
  
  return keyMap[key] || null;
}

function dispatchMappedKey(mappedKey, eventType) {
  try {
    const event = new KeyboardEvent(eventType, {
      key: mappedKey.key,
      code: mappedKey.code,
      keyCode: mappedKey.keyCode,
      which: mappedKey.keyCode,
      bubbles: true,
      cancelable: true,
      composed: true
    });
    
    if (iframe.contentWindow) {
      iframe.contentWindow.dispatchEvent(event);
    }
    if (iframe.contentDocument) {
      iframe.contentDocument.dispatchEvent(event);
      iframe.contentDocument.documentElement?.dispatchEvent(event);
    }
    
    iframe.contentWindow?.postMessage({
      type: 'keyboard_event',
      eventType: eventType,
      key: mappedKey.key,
      code: mappedKey.code,
      keyCode: mappedKey.keyCode
    }, '*');
    
  } catch (err) {
    console.log('Dispatch key error:', err);
  }
}

// ============= TIMER SPEEDRUN =============
function setupTimerSystem() {
  document.addEventListener('keydown', handleTimerKeyDown, true);
}

function handleTimerKeyDown(e) {
  if (e.repeat || isSettingKey) return;
  
  const key = e.key.toLowerCase();
  
  if (key === config.timerStartKey.toLowerCase() && !e.ctrlKey && !e.altKey && !e.metaKey && !e.shiftKey) {
    e.preventDefault();
    e.stopPropagation();
    startTimer();
  } 
  else if (key === config.timerPauseKey.toLowerCase() && !e.ctrlKey && !e.altKey && !e.metaKey && !e.shiftKey) {
    e.preventDefault();
    e.stopPropagation();
    pauseTimer();
  }
  else if (key === config.timerResetKey.toLowerCase() && !e.ctrlKey && !e.altKey && !e.metaKey && !e.shiftKey) {
    e.preventDefault();
    e.stopPropagation();
    resetTimer();
  }
}

function startTimer() {
  if (!timerVisible) return;
  
  if (timerState === 'stopped' || timerState === 'paused') {
    timerStartTime = performance.now() - timerCurrentTime;
    timerState = 'running';
    updateTimerDisplay();
    
    const updateFrame = () => {
      if (timerState === 'running') {
        updateTimerDisplay();
        timerInterval = requestAnimationFrame(updateFrame);
      }
    };
    timerInterval = requestAnimationFrame(updateFrame);
  }
}

function pauseTimer() {
  if (!timerVisible || timerState !== 'running') return;
  
  cancelAnimationFrame(timerInterval);
  timerState = 'paused';
}

function resetTimer() {
  if (!timerVisible) return;
  
  cancelAnimationFrame(timerInterval);
  timerState = 'stopped';
  timerCurrentTime = 0;
  timerDisplay.textContent = '00:00.00';
}

function updateTimerDisplay() {
  if (!timerVisible || timerState !== 'running') return;
  
  timerCurrentTime = performance.now() - timerStartTime;
  timerDisplay.textContent = formatTime(timerCurrentTime);
}

function formatTime(ms) {
  const totalSec = Math.floor(ms / 1000);
  const m = Math.floor(totalSec / 60);
  const s = totalSec % 60;
  const cs = Math.floor((ms % 1000) / 10);
  
  return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}.${cs.toString().padStart(2, '0')}`;
}

function toggleTimerVisibility() {
  config.showTimer = !config.showTimer;
  timerOverlay.style.display = config.showTimer ? 'block' : 'none';
  timerVisible = config.showTimer;
  
  if (config.showTimer) {
    updateTimerDisplay();
  }
  
  saveConfig();
}

// ============= DÃ‰BLOCAGE COMPLET CORRIGÃ‰ =============
function unlockAllCharacters() {
  console.log('ğŸ”“ DÃ©blocage COMPLET activÃ©...');
  
  const cheatScript = `
    console.log('ğŸ® MYNVO CHEAT: Activation des triches...');
    
    // PiÃ¨ces illimitÃ©es
    if (typeof Game !== 'undefined') {
      Game.currency = 999999;
      Game.coins = 999999;
      console.log('ğŸ’° MYNVO: 999,999 piÃ¨ces ajoutÃ©es!');
    }
    
    // DÃ©bloquer personnages
    if (typeof characterManager !== 'undefined') {
      characterManager.unlockAllCharacters();
      console.log('ğŸ­ MYNVO: Tous les personnages dÃ©bloquÃ©s!');
    }
    
    // Score boost
    if (typeof score !== 'undefined') {
      score.multiplier = 10;
      console.log('â­ MYNVO: Multiplicateur x10 activÃ©!');
    }
    
    // Power-ups illimitÃ©s
    if (typeof powerups !== 'undefined') {
      powerups.jetpack = 99;
      powerups.superSneakers = 99;
      powerups.coinMagnet = 99;
      powerups.boost = 99;
      console.log('âš¡ MYNVO: Power-ups illimitÃ©s!');
    }
    
    window.MYNVO_CHEATS = {
      unlockAll: function() {
        Game.currency = 999999;
        Game.coins = 999999;
        if (characterManager) characterManager.unlockAllCharacters();
        console.log('ğŸ® MYNVO: TOUT DÃ‰BLOQUÃ‰!');
      }
    };
    
    MYNVO_CHEATS.unlockAll();
  `;
  
  try {
    iframe.contentWindow.eval(cheatScript);
    showNotification('ğŸ‰ TOUT EST DÃ‰BLOQUÃ‰! 999,999 piÃ¨ces - Personnages - Power-ups!', 'success', true);
  } catch (error) {
    console.log('Injection directe Ã©chouÃ©e, mÃ©thode alternative...');
    const scriptElement = document.createElement('script');
    scriptElement.textContent = cheatScript;
    iframe.contentDocument.head.appendChild(scriptElement);
    showNotification('ğŸ‰ Triches activÃ©es avec succÃ¨s!', 'success', true);
  }
}

// ============= FPS COUNTER =============
let fpsFrames = 0;
let fpsLastTime = performance.now();

function updateFPS() {
  fpsFrames++;
  const now = performance.now();
  
  if (now - fpsLastTime >= 1000) {
    const fps = Math.round((fpsFrames * 1000) / (now - fpsLastTime));
    document.getElementById('fps-value').textContent = fps;
    
    fpsFrames = 0;
    fpsLastTime = now;
  }
  
  requestAnimationFrame(updateFPS);
}
updateFPS();

function toggleFPS() {
  config.showFPS = !config.showFPS;
  document.getElementById('fps-overlay').style.display = config.showFPS ? 'block' : 'none';
  saveConfig();
}

function toggleTop3() {
  config.showTop3 = !config.showTop3;
  document.getElementById('top3-overlay').style.display = config.showTop3 ? 'block' : 'none';
  saveConfig();
}

// ============= PLEIN Ã‰CRAN =============
function toggleFullscreen() {
  const gameFrame = document.querySelector('.game-frame');
  
  if (!document.fullscreenElement) {
    if (gameFrame.requestFullscreen) {
      gameFrame.requestFullscreen();
    } else if (gameFrame.webkitRequestFullscreen) {
      gameFrame.webkitRequestFullscreen();
    }
  } else {
    document.exitFullscreen();
  }
}

// ============= GESTION DES THÃˆMES =============
function changeTheme(themeName) {
  document.body.classList.remove('theme-violet', 'theme-white', 'theme-dark', 'theme-red', 'theme-green', 'theme-blue');
  document.body.classList.add(`theme-${themeName}`);
  
  config.theme = themeName;
  saveConfig();
  
  initParticles();
  showNotification(`ğŸ¨ ThÃ¨me ${themeName.charAt(0).toUpperCase() + themeName.slice(1)} appliquÃ©!`, 'success');
}

// ============= DRAG & DROP =============
function setupDragAndDrop() {
  const draggableElements = [
    document.getElementById('fps-overlay'),
    document.getElementById('top3-overlay'),
    document.getElementById('speedrun-timer-overlay')
  ];
  
  draggableElements.forEach(element => {
    if (!element) return;
    
    element.addEventListener('mousedown', startDrag);
    element.addEventListener('touchstart', startDragTouch, { passive: false });
  });
  
  document.addEventListener('mousemove', drag);
  document.addEventListener('touchmove', dragTouch, { passive: false });
  document.addEventListener('mouseup', stopDrag);
  document.addEventListener('touchend', stopDrag);
}

function startDrag(e) {
  isDragging = true;
  currentDraggedElement = e.target;
  
  const rect = currentDraggedElement.getBoundingClientRect();
  dragOffset.x = e.clientX - rect.left;
  dragOffset.y = e.clientY - rect.top;
  
  currentDraggedElement.style.opacity = '0.7';
  e.preventDefault();
}

function startDragTouch(e) {
  if (e.touches.length !== 1) return;
  
  isDragging = true;
  currentDraggedElement = e.target;
  
  const rect = currentDraggedElement.getBoundingClientRect();
  dragOffset.x = e.touches[0].clientX - rect.left;
  dragOffset.y = e.touches[0].clientY - rect.top;
  
  currentDraggedElement.style.opacity = '0.7';
  e.preventDefault();
}

function drag(e) {
  if (!isDragging || !currentDraggedElement) return;
  
  const x = e.clientX - dragOffset.x;
  const y = e.clientY - dragOffset.y;
  
  currentDraggedElement.style.left = `${x}px`;
  currentDraggedElement.style.top = `${y}px`;
  currentDraggedElement.style.right = 'auto';
  currentDraggedElement.style.bottom = 'auto';
  
  saveOverlayPosition(currentDraggedElement.id, { left: `${x}px`, top: `${y}px` });
}

function dragTouch(e) {
  if (!isDragging || !currentDraggedElement || e.touches.length !== 1) return;
  
  const x = e.touches[0].clientX - dragOffset.x;
  const y = e.touches[0].clientY - dragOffset.y;
  
  currentDraggedElement.style.left = `${x}px`;
  currentDraggedElement.style.top = `${y}px`;
  currentDraggedElement.style.right = 'auto';
  currentDraggedElement.style.bottom = 'auto';
  
  saveOverlayPosition(currentDraggedElement.id, { left: `${x}px`, top: `${y}px` });
  
  e.preventDefault();
}

function stopDrag() {
  if (!isDragging || !currentDraggedElement) return;
  
  currentDraggedElement.style.opacity = '';
  isDragging = false;
  currentDraggedElement = null;
}

function saveOverlayPosition(id, position) {
  const overlayKey = id.replace('-overlay', '');
  config.overlayPositions[overlayKey] = position;
  saveConfig();
}

function applyOverlayPositions() {
  Object.keys(config.overlayPositions).forEach(key => {
    const element = document.getElementById(`${key}-overlay`);
    if (element && config.overlayPositions[key]) {
      Object.assign(element.style, config.overlayPositions[key]);
    }
  });
}

// ============= MODAL DE CONFIGURATION CORRIGÃ‰ =============
function openSettingsModal() {
  console.log('ğŸ”§ Ouverture des paramÃ¨tres...');
  
  const existingModal = document.getElementById('mynvo-settings');
  if (existingModal) {
    existingModal.remove();
    return;
  }

  const modal = document.createElement('div');
  modal.id = 'mynvo-settings';
  modal.className = 'mynvo-modal';
  modal.innerHTML = `
    <h3 style="color:var(--primary);margin-bottom:10px;text-align:center;">ğŸ® Configuration ComplÃ¨te MYNVO</h3>
    
    <div class="settings-tabs">
      <div class="settings-tab active" data-tab="keys">Touches</div>
      <div class="settings-tab" data-tab="timer">Timer</div>
      <div class="settings-tab" data-tab="display">Affichage</div>
      <div class="settings-tab" data-tab="themes">ThÃ¨mes</div>
      <div class="settings-tab" data-tab="game">Jeu</div>
    </div>
    
    <!-- Onglet Touches -->
    <div class="settings-tab-content active" id="keys-tab">
      <div class="settings-section">
        <h3>ğŸ¯ Touches de Jeu (ZQSD)</h3>
        <div class="mynvo-row">
          <div class="mynvo-label">Haut</div>
          <div class="key-display" data-key="up">${config.customKeys.up.toUpperCase()}</div>
        </div>
        <div class="mynvo-row">
          <div class="mynvo-label">Bas</div>
          <div class="key-display" data-key="down">${config.customKeys.down.toUpperCase()}</div>
        </div>
        <div class="mynvo-row">
          <div class="mynvo-label">Gauche</div>
          <div class="key-display" data-key="left">${config.customKeys.left.toUpperCase()}</div>
        </div>
        <div class="mynvo-row">
          <div class="mynvo-label">Droite</div>
          <div class="key-display" data-key="right">${config.customKeys.right.toUpperCase()}</div>
        </div>
        <div class="mynvo-row">
          <div class="mynvo-label">Hoverboard</div>
          <div class="key-display" data-key="hoverboard">${config.customKeys.hoverboard === ' ' ? 'ESPACE' : config.customKeys.hoverboard.toUpperCase()}</div>
        </div>
      </div>
    </div>
    
    <!-- Onglet Timer -->
    <div class="settings-tab-content" id="timer-tab">
      <div class="settings-section">
        <h3>â±ï¸ Configuration du Timer</h3>
        <div class="mynvo-row">
          <div class="mynvo-label">DÃ©marrer</div>
          <div class="key-display" data-key="timerStartKey">${getKeyDisplayName(config.timerStartKey)}</div>
        </div>
        <div class="mynvo-row">
          <div class="mynvo-label">Pause</div>
          <div class="key-display" data-key="timerPauseKey">${getKeyDisplayName(config.timerPauseKey)}</div>
        </div>
        <div class="mynvo-row">
          <div class="mynvo-label">Reset</div>
          <div class="key-display" data-key="timerResetKey">${getKeyDisplayName(config.timerResetKey)}</div>
        </div>
      </div>
    </div>
    
    <!-- Onglet Affichage -->
    <div class="settings-tab-content" id="display-tab">
      <div class="settings-section">
        <h3>ğŸ‘ï¸ Ã‰lÃ©ments d'affichage</h3>
        <div class="mynvo-row">
          <div class="mynvo-label">Afficher FPS</div>
          <label class="toggle-switch">
            <input type="checkbox" id="show-fps" ${config.showFPS ? 'checked' : ''}>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="mynvo-row">
          <div class="mynvo-label">Afficher TOP 3</div>
          <label class="toggle-switch">
            <input type="checkbox" id="show-top3" ${config.showTop3 ? 'checked' : ''}>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="mynvo-row">
          <div class="mynvo-label">Afficher Timer</div>
          <label class="toggle-switch">
            <input type="checkbox" id="show-timer" ${config.showTimer ? 'checked' : ''}>
            <span class="toggle-slider"></span>
          </label>
        </div>
      </div>
    </div>
    
    <!-- Onglet ThÃ¨mes -->
    <div class="settings-tab-content" id="themes-tab">
      <div class="settings-section">
        <h3>ğŸ¨ ThÃ¨mes du site</h3>
        <p style="margin-bottom: 15px; color: var(--text-muted);">Choisissez un thÃ¨me pour personnaliser l'apparence :</p>
        
        <div class="theme-options">
          <div class="theme-option violet ${config.theme === 'violet' ? 'active' : ''}" onclick="changeTheme('violet')">
            Violet
          </div>
          <div class="theme-option white ${config.theme === 'white' ? 'active' : ''}" onclick="changeTheme('white')">
            Blanc
          </div>
          <div class="theme-option dark ${config.theme === 'dark' ? 'active' : ''}" onclick="changeTheme('dark')">
            Sombre
          </div>
          <div class="theme-option red ${config.theme === 'red' ? 'active' : ''}" onclick="changeTheme('red')">
            Rouge
          </div>
          <div class="theme-option green ${config.theme === 'green' ? 'active' : ''}" onclick="changeTheme('green')">
            Vert
          </div>
          <div class="theme-option blue ${config.theme === 'blue' ? 'active' : ''}" onclick="changeTheme('blue')">
            Bleu
          </div>
        </div>
      </div>
    </div>
    
    <!-- Onglet Jeu -->
    <div class="settings-tab-content" id="game-tab">
      <div class="settings-section">
        <h3>ğŸ® Options de jeu</h3>
        <div class="mynvo-row">
          <button class="quick-btn give-piece-btn" onclick="unlockAllCharacters();" style="width:100%;">ğŸ”“ DÃ©bloquer Tous les Personnages + PiÃ¨ces</button>
        </div>
      </div>
    </div>

    <div style="text-align:center;margin-top:12px;">
      <button onclick="closeSettingsModal()" style="background:var(--primary);color:#fff;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:700;">Fermer</button>
    </div>
  `;
  
  document.body.appendChild(modal);
  initSettingsTabs();
  initSettingsEventListeners();
  
  modal.querySelectorAll('.key-display').forEach(display => {
    display.addEventListener('click', function() {
      startKeySetting(this.dataset.key);
    });
  });
}

function initSettingsTabs() {
  const tabs = document.querySelectorAll('.settings-tab');
  const contents = document.querySelectorAll('.settings-tab-content');
  
  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      const tabId = this.dataset.tab;
      
      tabs.forEach(t => t.classList.remove('active'));
      contents.forEach(c => c.classList.remove('active'));
      
      this.classList.add('active');
      document.getElementById(`${tabId}-tab`).classList.add('active');
    });
  });
}

function initSettingsEventListeners() {
  document.getElementById('show-fps')?.addEventListener('change', function() {
    config.showFPS = this.checked;
    saveConfig();
    applyOverlaysFromConfig();
  });
  
  document.getElementById('show-top3')?.addEventListener('change', function() {
    config.showTop3 = this.checked;
    saveConfig();
    applyOverlaysFromConfig();
  });
  
  document.getElementById('show-timer')?.addEventListener('change', function() {
    config.showTimer = this.checked;
    saveConfig();
    applyOverlaysFromConfig();
  });
}

function startKeySetting(keyType) {
  isSettingKey = true;
  currentKeySetting = keyType;
  
  const display = document.querySelector(`#mynvo-settings .key-display[data-key="${keyType}"]`);
  display.textContent = '...';
  display.classList.add('active');
  
  showNotification(`Appuyez sur une touche pour ${keyType}...`, 'info');
  
  const keyListener = function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    let keyValue = e.key.toLowerCase();
    let displayValue = e.key.toUpperCase();
    
    if (e.code === 'Space') {
      keyValue = ' ';
      displayValue = 'ESPACE';
    }
    
    if (keyType.startsWith('timer')) {
      config[keyType] = keyValue;
    } else {
      config.customKeys[keyType] = keyValue;
    }
    
    display.textContent = displayValue;
    display.classList.remove('active');
    
    saveConfig();
    document.removeEventListener('keydown', keyListener);
    isSettingKey = false;
    currentKeySetting = null;
    
    showNotification(`âœ… Touche ${keyType} dÃ©finie sur: ${displayValue}`, 'success');
    setupZQSDSystem();
    setupTimerSystem();
  };
  
  document.addEventListener('keydown', keyListener, { once: true });
}

function getKeyDisplayName(keyCode) {
  const keyNames = {
    'Control': 'CTRL',
    'Shift': 'SHIFT',
    'Alt': 'ALT',
    'Meta': 'META',
    ' ': 'ESPACE',
    'Space': 'ESPACE',
    'Enter': 'ENTRÃ‰E',
    'Tab': 'TAB',
    'Escape': 'ESC'
  };
  return keyNames[keyCode] || keyCode.toUpperCase();
}

function closeSettingsModal() {
  const modal = document.getElementById('mynvo-settings');
  if (modal) modal.remove();
  isSettingKey = false;
  currentKeySetting = null;
}

// ============= NOTIFICATIONS =============
function showNotification(message, type = "info", multiline = false) {
  const notification = document.createElement('div');
  notification.className = 'notification' + (multiline ? ' multiline' : '');
  notification.innerHTML = `<span>${message}</span>`;
  
  if (type === "error") {
    notification.style.borderLeftColor = "var(--danger)";
  } else if (type === "success") {
    notification.style.borderLeftColor = "var(--success)";
  } else if (type === "warning") {
    notification.style.borderLeftColor = "var(--warning)";
  }
  
  document.body.appendChild(notification);
  
  setTimeout(() => notification.classList.add('show'), 10);
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => notification.remove(), 300);
  }, multiline ? 5000 : 3000);
}

// ============= PARTICULES =============
function initParticles() {
  const container = document.getElementById('particles-container');
  container.innerHTML = '';
  const particleCount = 30;
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    
    const size = Math.random() * 5 + 2;
    particle.style.width = `${size}px`;
    particle.style.height = `${size}px`;
    particle.style.left = `${Math.random() * 100}%`;
    particle.style.top = `${Math.random() * 100}%`;
    particle.style.animationDuration = `${Math.random() * 20 + 10}s`;
    particle.style.animationDelay = `${Math.random() * 5}s`;
    
    container.appendChild(particle);
  }
}

// ============= CONFIGURATION =============
function saveConfig() {
  localStorage.setItem("mynvoConfig", JSON.stringify(config));
}

function loadConfig() {
  try {
    const saved = localStorage.getItem("mynvoConfig");
    if (saved) {
      const savedConfig = JSON.parse(saved);
      config = { ...config, ...savedConfig };
      
      if (savedConfig.customKeys) {
        config.customKeys = { ...config.customKeys, ...savedConfig.customKeys };
      }
      
      if (savedConfig.theme) {
        changeTheme(savedConfig.theme);
      } else {
        changeTheme('violet');
      }
    } else {
      changeTheme('violet');
    }
  } catch(e) {
    console.warn('Configuration corrompue, rÃ©initialisation...');
    changeTheme('violet');
    localStorage.removeItem("mynvoConfig");
  }
}

function applyOverlaysFromConfig() {
  document.getElementById('fps-overlay').style.display = config.showFPS ? 'block' : 'none';
  document.getElementById('top3-overlay').style.display = config.showTop3 ? 'block' : 'none';
  document.getElementById('speedrun-timer-overlay').style.display = config.showTimer ? 'block' : 'none';
  timerVisible = config.showTimer;
  
  applyOverlayPositions();
}

// ============= INITIALISATION COMPLÃˆTE =============
function initializeExtensionFeatures() {
  console.log('ğŸš€ Initialisation des fonctionnalitÃ©s MYNVO...');
  
  loadConfig();
  applyOverlaysFromConfig();
  setupZQSDSystem();
  setupTimerSystem();
  setupDragAndDrop();
  
  console.log('âœ… Tous les systÃ¨mes activÃ©s!');
}

// ============= Ã‰VÃ‰NEMENTS AU CHARGEMENT =============
document.addEventListener('DOMContentLoaded', function() {
  console.log('ğŸ“„ DOM chargÃ©, initialisation MYNVO...');
  
  initParticles();
  loadConfig();
  applyOverlaysFromConfig();
  
  // Ã‰vÃ©nements des boutons
  document.getElementById('settings-link').addEventListener('click', openSettingsModal);
  document.getElementById('play-link').addEventListener('click', () => {
    document.querySelector('.game-container')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
    iframe.focus();
  });
  
  document.getElementById('fs-btn').addEventListener('click', toggleFullscreen);
  document.getElementById('settings-quick-btn').addEventListener('click', openSettingsModal);
  document.getElementById('timer-quick-btn').addEventListener('click', toggleTimerVisibility);
  document.getElementById('fps-quick-btn').addEventListener('click', toggleFPS);
  document.getElementById('fullscreen-quick-btn').addEventListener('click', toggleFullscreen);
  document.getElementById('top3-quick-btn').addEventListener('click', toggleTop3);
  document.getElementById('unlock-all-btn').addEventListener('click', unlockAllCharacters);
  document.getElementById('close-bottom-menu').addEventListener('click', function() {
    document.getElementById('bottom-menu').classList.remove('visible');
  });
  
  // Menu contextuel
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    document.getElementById('bottom-menu').classList.toggle('visible');
  });
  
  console.log('âœ… MYNVO initialisÃ© avec succÃ¨s!');
});

// ============= LOGS DE DÃ‰MARRAGE =============
console.log('%câ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 'color: #7c62dc; font-weight: bold;');
console.log('%câ•‘  SUBWAY SURFERS 2025 - Ã‰DITION MYNVO  â•‘', 'color: #7c62dc; font-weight: bold;');
console.log('%câ•‘  SystÃ¨me IntÃ©grÃ© v5.0 - CORRIGÃ‰      â•‘', 'color: #7c62dc; font-weight: bold;');
console.log('%câ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #7c62dc; font-weight: bold;');
console.log('');
console.log('%cğŸ® Touches ZQSD activÃ©es:', 'color: #00cc66; font-weight: bold;');
console.log('   â€¢ Z = Haut | Q = Gauche | S = Bas | D = Droite');
console.log('   â€¢ ESPACE = Hoverboard');
console.log('');
console.log('%câš™ï¸ FonctionnalitÃ©s activÃ©es:', 'color: #7c62dc; font-weight: bold;');
console.log('   â€¢ ParamÃ¨tres complets fonctionnels');
console.log('   â€¢ ThÃ¨me violet par dÃ©faut');
console.log('   â€¢ DÃ©blocage complet (piÃ¨ces + personnages)');
console.log('   â€¢ Timer speedrun avec touches T/ESPACE/R');
console.log('   â€¢ FPS Counter en temps rÃ©el');
console.log('');
console.log('%cğŸ’¡ Astuce:', 'color: #ffaa00; font-weight: bold;');
console.log('   Clic droit pour le menu rapide!');
console.log('');
  </script>
</body>
</html>
