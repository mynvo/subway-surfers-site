<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subway Surfers by Mynvo</title>
  <style>
    :root {
      --primary: #7c62dc;
      --bg-dark: #0a0a0a;
      --bg-card: rgba(30, 30, 40, 0.8);
      --text-light: #f0f0f0;
      --success: #00cc66;
      --danger: #ff4444;
      --warning: #ffaa00;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    header {
      background: rgba(124, 98, 220, 0.15);
      backdrop-filter: blur(12px);
      padding: 18px 40px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      border-bottom: 2px solid var(--primary);
    }
    
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 34px;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    
    .logo span { color: var(--primary); }
    
    .nav-links {
      display: flex;
      gap: 24px;
    }
    
    .nav-links a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
      cursor: pointer;
    }
    
    .nav-links a:hover { color: var(--primary); }
    
    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 120px 20px 40px;
    }
    
    .game-container {
      width: 100%;
      max-width: 1350px;
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      border-radius: 28px;
      padding: 40px;
      border: 2px solid var(--primary);
    }
    
    .game-frame {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      border: 2px solid var(--primary);
    }
    
    iframe {
      width: 100%;
      height: 720px;
      border: none;
      background: #000000;
      display: block;
    }
    
    /* OVERLAYS - FORC√âS PARTOUT */
    #fps-overlay, #timer-overlay, #top3-overlay {
      position: fixed !important;
      z-index: 2147483647 !important;
      pointer-events: none !important;
      font-family: 'Courier New', monospace !important;
    }
    
    :fullscreen #fps-overlay,
    :fullscreen #timer-overlay,
    :fullscreen #top3-overlay,
    :-webkit-full-screen #fps-overlay,
    :-webkit-full-screen #timer-overlay,
    :-webkit-full-screen #top3-overlay {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    #fps-overlay {
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: var(--primary);
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 20px;
      font-weight: 700;
      border: 3px solid var(--primary);
      box-shadow: 0 0 20px rgba(124, 98, 220, 0.6);
    }
    
    #timer-overlay {
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      padding: 14px 20px;
      border-radius: 12px;
      border: 3px solid var(--primary);
      font-weight: 700;
      font-size: 18px;
      box-shadow: 0 0 20px rgba(124, 98, 220, 0.6);
    }
    
    #timer-overlay.running {
      border-color: var(--success);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(0, 204, 102, 0.6); }
      50% { box-shadow: 0 0 30px rgba(0, 204, 102, 0.9); }
    }
    
    .timer-display {
      font-size: 26px;
      font-weight: bold;
      color: var(--success);
      text-shadow: 0 0 10px rgba(0, 204, 102, 0.5);
    }
    
    .timer-status {
      font-size: 12px;
      color: #aaa;
      margin-top: 4px;
    }
    
    #top3-overlay {
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.95);
      color: #fff;
      padding: 18px 24px;
      border-radius: 14px;
      border: 3px solid var(--primary);
      font-size: 14px;
      min-width: 300px;
      box-shadow: 0 0 25px rgba(124, 98, 220, 0.6);
    }
    
    #top3-overlay .title {
      color: var(--primary);
      font-size: 17px;
      font-weight: 900;
      margin-bottom: 12px;
      text-align: center;
    }
    
    #top3-overlay .player {
      margin: 8px 0;
      padding: 8px;
      border-radius: 8px;
      background: rgba(124, 98, 220, 0.1);
    }
    
    #top3-overlay .player.first {
      color: var(--primary);
      font-weight: 700;
      font-size: 16px;
      background: rgba(124, 98, 220, 0.2);
    }
    
    .notification {
      position: fixed;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(20, 20, 30, 0.95);
      color: white;
      padding: 14px 24px;
      border-radius: 10px;
      border-left: 4px solid var(--primary);
      z-index: 2147483646;
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
    }
    
    .notification.show { opacity: 1; }
    
    footer {
      text-align: center;
      padding: 25px;
      font-size: 15px;
      opacity: 0.85;
    }

    @media (max-width: 768px) {
      iframe { height: 400px; }
      #fps-overlay, #timer-overlay, #top3-overlay {
        font-size: 14px;
        padding: 10px 14px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        Subway<span>Surfers</span> by <span>Mynvo</span>
      </div>
      <div class="nav-links">
        <a id="play-link">Jouer</a>
        <a href="https://discord.gg/bQTtDXmF" target="_blank">Discord</a>
      </div>
    </div>
  </header>

  <main>
    <div class="game-container">
      <div class="game-frame">
        <iframe id="game-iframe" src="./game/" allowfullscreen allow="autoplay; fullscreen *"></iframe>
      </div>
    </div>
  </main>

  <div id="fps-overlay">üéÆ FPS: <span id="fps-value">60</span></div>

  <div id="timer-overlay">
    <div class="timer-display"><span id="timer-value">00:00.00</span></div>
    <div class="timer-status">F1=Start | F2=Stop | F3=Reset</div>
  </div>

  <div id="top3-overlay">
    <div class="title">üèÜ TOP 3 NO COIN</div>
    <div class="player first">ü•á Mynvo ‚Äì 13:27</div>
    <div class="player">ü•à Le_A ‚Äì 11:51</div>
    <div class="player">ü•â .... ‚Äì 0:00</div>
  </div>

  <footer>Subway Surfers by Mynvo ¬© 2023</footer>

  <script>
    const iframe = document.getElementById('game-iframe');
    let timerInterval = null;
    let timerStart = 0;
    let timerElapsed = 0;
    let timerActive = false;

    // ============= GIVE UNITY FILESYSTEM =============
    function unityGiveResources() {
      console.log('üí∞ [MYNVO] Injection Unity FS Give...');
      
      try {
        const iframeWindow = iframe.contentWindow;
        
        // Attendre que FS soit disponible
        const waitForFS = setInterval(() => {
          if (iframeWindow.FS && iframeWindow.Module) {
            clearInterval(waitForFS);
            console.log('‚úÖ Unity FS d√©tect√©!');
            
            // Injecter le script de modification
            const script = iframeWindow.document.createElement('script');
            script.textContent = `
              (function() {
                console.log('üí∞ [MYNVO] Hook Unity FileSystem...');
                
                // Hook writeFile pour modifier les sauvegardes
                if (typeof FS !== 'undefined' && FS.writeFile) {
                  const originalWrite = FS.writeFile;
                  
                  FS.writeFile = function(path, data, options) {
                    console.log('üìù Unity Write:', path);
                    
                    // Si c'est une sauvegarde de donn√©es joueur
                    if (path && (path.includes('save') || path.includes('player') || path.includes('data'))) {
                      try {
                        // Convertir en string si c'est un buffer
                        let dataStr = data;
                        if (data instanceof Uint8Array) {
                          dataStr = new TextDecoder().decode(data);
                        }
                        
                        // Chercher et modifier les valeurs
                        let modified = dataStr;
                        
                        // Patterns Unity communs pour coins/keys
                        modified = modified.replace(/"coins":\\d+/g, '"coins":999999999');
                        modified = modified.replace(/"keys":\\d+/g, '"keys":999999999');
                        modified = modified.replace(/"Coins":\\d+/g, '"Coins":999999999');
                        modified = modified.replace(/"Keys":\\d+/g, '"Keys":999999999');
                        modified = modified.replace(/"gold":\\d+/g, '"gold":999999999');
                        modified = modified.replace(/"currency":\\d+/g, '"currency":999999999');
                        
                        if (modified !== dataStr) {
                          console.log('‚úÖ Donn√©es modifi√©es!');
                          // Reconvertir en Uint8Array si n√©cessaire
                          if (data instanceof Uint8Array) {
                            data = new TextEncoder().encode(modified);
                          } else {
                            data = modified;
                          }
                        }
                      } catch(e) {
                        console.warn('Erreur modification:', e);
                      }
                    }
                    
                    return originalWrite.call(this, path, data, options);
                  };
                  
                  console.log('‚úÖ Hook FS.writeFile install√©!');
                }
                
                // Hook readFile pour forcer les valeurs au chargement
                if (typeof FS !== 'undefined' && FS.readFile) {
                  const originalRead = FS.readFile;
                  
                  FS.readFile = function(path, options) {
                    const result = originalRead.call(this, path, options);
                    
                    if (path && (path.includes('save') || path.includes('player') || path.includes('data'))) {
                      console.log('üìñ Unity Read:', path);
                      
                      try {
                        let dataStr = result;
                        if (result instanceof Uint8Array) {
                          dataStr = new TextDecoder().decode(result);
                        }
                        
                        let modified = dataStr;
                        modified = modified.replace(/"coins":\\d+/g, '"coins":999999999');
                        modified = modified.replace(/"keys":\\d+/g, '"keys":999999999');
                        modified = modified.replace(/"Coins":\\d+/g, '"Coins":999999999');
                        modified = modified.replace(/"Keys":\\d+/g, '"Keys":999999999');
                        
                        if (modified !== dataStr) {
                          console.log('‚úÖ Lecture modifi√©e!');
                          if (result instanceof Uint8Array) {
                            return new TextEncoder().encode(modified);
                          }
                          return modified;
                        }
                      } catch(e) {}
                    }
                    
                    return result;
                  };
                  
                  console.log('‚úÖ Hook FS.readFile install√©!');
                }
                
                console.log('üí∞ [MYNVO] Hooks Unity install√©s avec succ√®s!');
              })();
            `;
            
            iframeWindow.document.head.appendChild(script);
            showNotification('üí∞ Give Unity activ√©! Les sauvegardes seront modifi√©es', 'success');
          }
        }, 500);
        
        // Timeout apr√®s 10 secondes
        setTimeout(() => clearInterval(waitForFS), 10000);
        
      } catch (error) {
        console.error('‚ùå Erreur Give:', error);
      }
    }

    // D√©clencher au chargement
    iframe.addEventListener('load', () => {
      console.log('‚úÖ Iframe charg√©e');
      
      // Attendre que Unity soit initialis√©
      setTimeout(unityGiveResources, 2000);
      setTimeout(unityGiveResources, 5000);
      setTimeout(unityGiveResources, 8000);
    });

    // ============= TOUCHES ZQSD =============
    const keyMapping = {
      'z': { key: 'ArrowUp', code: 'ArrowUp', keyCode: 38 },
      'q': { key: 'ArrowLeft', code: 'ArrowLeft', keyCode: 37 },
      's': { key: 'ArrowDown', code: 'ArrowDown', keyCode: 40 },
      'd': { key: 'ArrowRight', code: 'ArrowRight', keyCode: 39 },
      ' ': { key: ' ', code: 'Space', keyCode: 32 }
    };

    function setupZQSD() {
      ['keydown', 'keyup'].forEach(type => {
        window.addEventListener(type, (e) => {
          const key = e.key.toLowerCase();
          const mapped = keyMapping[key];
          
          if (mapped) {
            e.preventDefault();
            e.stopImmediatePropagation();
            
            const newEvent = new KeyboardEvent(type, {
              key: mapped.key,
              code: mapped.code,
              keyCode: mapped.keyCode,
              which: mapped.keyCode,
              bubbles: true,
              cancelable: true
            });
            
            try {
              iframe.contentWindow.document.dispatchEvent(newEvent);
              iframe.contentWindow.dispatchEvent(newEvent);
              console.log(`üéÆ ${type}: ${key} ‚Üí ${mapped.key}`);
            } catch(e) {}
          }
        }, true);
      });
    }

    // ============= TIMER =============
    function setupTimer() {
      document.addEventListener('keydown', (e) => {
        if (e.key === 'F1') {
          e.preventDefault();
          if (!timerActive) startTimer();
        }
        else if (e.key === 'F2') {
          e.preventDefault();
          if (timerActive) stopTimer();
        }
        else if (e.key === 'F3') {
          e.preventDefault();
          resetTimer();
        }
      });
    }

    function startTimer() {
      timerStart = Date.now() - timerElapsed;
      timerActive = true;
      document.getElementById('timer-overlay').classList.add('running');
      
      timerInterval = setInterval(() => {
        timerElapsed = Date.now() - timerStart;
        document.getElementById('timer-value').textContent = formatTime(timerElapsed);
      }, 10);
      
      showNotification('‚ñ∂Ô∏è Timer d√©marr√©', 'success');
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerActive = false;
      document.getElementById('timer-overlay').classList.remove('running');
      showNotification('‚è∏Ô∏è Timer arr√™t√©', 'warning');
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timerActive = false;
      timerElapsed = 0;
      document.getElementById('timer-value').textContent = '00:00.00';
      document.getElementById('timer-overlay').classList.remove('running');
      showNotification('üîÑ Timer reset', 'info');
    }

    function formatTime(ms) {
      const m = Math.floor(ms / 60000);
      const s = Math.floor((ms % 60000) / 1000);
      const cs = Math.floor((ms % 1000) / 10);
      return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}.${String(cs).padStart(2, '0')}`;
    }

    // ============= FPS =============
    let fpsFrames = 0;
    let fpsLast = performance.now();
    
    function updateFPS() {
      fpsFrames++;
      const now = performance.now();
      
      if (now - fpsLast >= 1000) {
        const fps = Math.round((fpsFrames * 1000) / (now - fpsLast));
        document.getElementById('fps-value').textContent = fps;
        
        const el = document.getElementById('fps-overlay');
        if (fps >= 55) {
          el.style.color = '#7c62dc';
          el.style.borderColor = '#7c62dc';
        } else if (fps >= 30) {
          el.style.color = '#f59e0b';
          el.style.borderColor = '#f59e0b';
        } else {
          el.style.color = '#ef4444';
          el.style.borderColor = '#ef4444';
        }
        
        fpsFrames = 0;
        fpsLast = now;
      }
      
      requestAnimationFrame(updateFPS);
    }

    // ============= NOTIFICATIONS =============
    function showNotification(msg, type = 'info') {
      const notif = document.createElement('div');
      notif.className = 'notification';
      notif.textContent = msg;
      
      const colors = { success: '#00cc66', warning: '#ffaa00', error: '#ff4444', info: '#7c62dc' };
      notif.style.borderLeftColor = colors[type];
      
      document.body.appendChild(notif);
      setTimeout(() => notif.classList.add('show'), 10);
      setTimeout(() => {
        notif.classList.remove('show');
        setTimeout(() => notif.remove(), 300);
      }, 4000);
    }

    // ============= INIT =============
    document.addEventListener('DOMContentLoaded', () => {
      setupZQSD();
      setupTimer();
      updateFPS();
      
      console.log('%cüéÆ MYNVO READY', 'color:#7c62dc;font-weight:bold;font-size:16px');
      console.log('%c‚å®Ô∏è  ZQSD + Espace', 'color:#7c62dc;font-size:14px');
      console.log('%c‚è±Ô∏è  F1/F2/F3 Timer', 'color:#7c62dc;font-size:14px');
      console.log('%cüí∞ Give FS Hook', 'color:#00cc66;font-size:14px');
      
      setTimeout(() => {
        showNotification('üéÆ Syst√®me MYNVO activ√©!', 'success');
      }, 1000);
    });

    document.getElementById('play-link').addEventListener('click', () => {
      document.querySelector('.game-container').scrollIntoView({ behavior: 'smooth' });
    });
  </script>
</body>
</html>
