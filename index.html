<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subway Surfers by Mynvo - NO COIN + Leaderboard Mondial</title>
  <meta name="description" content="Subway Surfers avec mode NO COIN, leaderboard mondial, touches custom et FPS counter - Créé par Mynvo"/>
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: white;
      overflow-x: hidden;
    }
    header {
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      padding: 20px 40px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      position: relative;
      z-index: 10;
    }
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo img {
      height: 60px;
      filter: drop-shadow(0 2px 10px rgba(0,0,0,0.5));
    }
    .logo span {
      font-size: 28px;
      font-weight: 900;
      margin-left: 12px;
      color: #ffd700;
    }
    .creator {
      font-size: 14px;
      opacity: 0.8;
    }
    main { flex: 1; padding: 20px; }
    .game-container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(0,0,0,0.3);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      position: relative;
    }
    .game-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .game-header h1 {
      font-size: 52px;
      font-weight: 900;
      margin-bottom: 15px;
      text-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .game-frame {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    .game-frame iframe {
      width: 100%;
      height: 720px;
      border: none;
    }
    .loading {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      text-align: center;
      z-index: 5;
    }
    .spinner {
      width: 60px; height: 60px;
      border: 6px solid rgba(255,255,255,0.3);
      border-top-color: #ffd700;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* MYNVO UI IN-GAME */
    #mynvo-ui {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      z-index: 9999;
      font-family: system-ui;
    }
    #fps-counter, #coin-indicator, #key-display, #mynvo-leaderboard {
      position: absolute;
      background: #0d1117;
      padding: 10px 18px;
      border-radius: 12px;
      font-weight: bold;
      pointer-events: auto;
      cursor: pointer;
    }
    #fps-counter { top: 15px; left: 15px; border: 2px solid #22c55e; color: #22c55e; }
    #coin-indicator { top: 80px; left: 15px; border: 2px solid #22c55e; color: #22c55e; }
    #key-display { bottom: 15px; right: 15px; background: #0d1117; color: #58a6ff; border: 1px solid #30363d; box-shadow: 0 0 15px #58a6ff33; }
    #mynvo-leaderboard { bottom: 20px; left: 20px; width: 320px; border: 2px solid #58a6ff; }

    /* Touches config panel */
    #key-config {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%) scale(0);
      background: #0d1117;
      padding: 25px;
      border-radius: 16px;
      border: 2px solid #58a6ff;
      z-index: 99999;
      transition: all 0.3s;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8);
    }
    #key-config.show { transform: translate(-50%,-50%) scale(1); }
    #key-config input { width: 50px; height: 40px; text-align: center; background: #21262d; color: white; border: 1px solid #30363d; border-radius: 8px; }
    #key-config button { margin-top: 15px; padding: 10px 20px; background: #58a6ff; color: white; border: none; border-radius: 10px; cursor: pointer; }

    footer { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); padding: 30px; text-align: center; }
    @media (max-width: 768px) {
      .game-frame iframe { height: 500px; }
      .game-header h1 { font-size: 36px; }
    }
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="logo">
        <img src="https://i.ibb.co/5Tp9Y3k/mynvo-logo.png" alt="Logo Mynvo">
        <span>Mynvo</span>
      </div>
      <div class="creator">Créé par Mynvo</div>
    </div>
  </header>

  <main>
    <div class="game-container">
      <div class="game-header">
        <h1>Subway Surfers - NO COIN CHALLENGE</h1>
        <p>Mode NO COIN + Leaderboard mondial + Touches custom + FPS</p>
      </div>

      <div class="game-frame">
        <div class="loading">
          <div class="spinner"></div>
          <p>Chargement du jeu...</p>
        </div>
        <iframe src="https://yell0wsuit.page/assets/games/subway-surfers-unity/index.html"
                allowfullscreen
                onload="document.querySelector('.loading').style.display='none'; initMynvo()"></iframe>

        <!-- MYNVO UI OVERLAY -->
        <div id="mynvo-ui">
          <div id="fps-counter">FPS: <span id="fps-value">0</span></div>
          <div id="coin-indicator" style="opacity:0">NO COIN | <span id="run-timer">0:00</span><br><small>Record: <span id="best-time">0:00</span></small></div>
          <div id="key-display">ZQSD | SPACE</div>
          <div id="mynvo-leaderboard">
            <div style="text-align:center;color:#58a6ff;font-weight:bold;margin-bottom:8px;">LEADERBOARD MONDIAL</div>
            <div id="leaderboard-content">Chargement...</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- PANNEAU CONFIG TOUCHES -->
  <div id="key-config">
    <h3 style="color:#58a6ff;text-align:center;margin-bottom:15px;">Configuration des touches</h3>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <label>Haut ← <input id="cfg-up" maxlength="1"></label>
      <label>Bas ← <input id="cfg-down" maxlength="1"></label>
      <label>Gauche ← <input id="cfg-left" maxlength="1"></label>
      <label>Droite ← <input id="cfg-right" maxlength="1"></label>
      <label>Saut ← <input id="cfg-jump" placeholder="SPACE"></label>
    </div>
    <div style="text-align:center;margin-top:15px;">
      <button onclick="saveKeys()">Enregistrer</button>
      <button onclick="document.getElementById('key-config').classList.remove('show')" style="background:#444;margin-left:10px;">Fermer</button>
    </div>
  </div>

  <footer>
    <div>© 2025 Subway Surfers by Mynvo — Tous les droits du jeu appartiennent à SYBO & Kiloo</div>
  </footer>

  <script>
    // ==================== MYNVO CORE (tout intégré) ====================
    const FIREBASE_URL = "https://mynvo-nocoin-default-rtdb.europe-west1.firebasedatabase.app/leaderboard.json";

    // Config touches
    const defaultKeys = { up: "z", down: "s", left: "q", right: "d", jump: " " };
    let keys = { ...defaultKeys };
    const loadKeys = () => {
      const saved = localStorage.getItem("mynvo-keys");
      if (saved) keys = JSON.parse(saved);
      updateKeyDisplay();
      applyKeyMapping();
    };
    const saveKeys = () => {
      keys.up = document.getElementById("cfg-up").value || "z";
      keys.down = document.getElementById("cfg-down").value || "s";
      keys.left = document.getElementById("cfg-left").value || "q";
      keys.right = document.getElementById("cfg-right").value || "d";
      keys.jump = document.getElementById("cfg-jump").value || " ";
      localStorage.setItem("mynvo-keys", JSON.stringify(keys));
      updateKeyDisplay();
      applyKeyMapping();
      alert("Touches enregistrées !");
    };
    const updateKeyDisplay = () => {
      const k = keys;
      document.getElementById("key-display").textContent = 
        `${k.left.toUpperCase()}${k.up.toUpperCase()}${k.down.toUpperCase()}${k.right.toUpperCase()} | ${k.jump===" "?"SPACE":k.jump.toUpperCase()}`;
    };

    // Redirection touches vers iframe
    const applyKeyMapping = () => {
      document.onkeydown = document.onkeyup = e => {
        const map = {
          [keys.up.toLowerCase()]: 38,
          [keys.down.toLowerCase()]: 40,
          [keys.left.toLowerCase()]: 37,
          [keys.right.toLowerCase()]: 39,
          [keys.jump.toLowerCase()]: 32
        };
        const code = map[e.key.toLowerCase()];
        if (!code) return;
        e.preventDefault();
        const iframe = document.querySelector("iframe");
        if (iframe && iframe.contentWindow) {
          iframe.contentWindow.postMessage({type: "key", keyCode: code, eventType: e.type}, "*");
        }
      };
    };

    // FPS Counter
    let fpsEnabled = true;
    let last = performance.now(), frames = 0;
    const updateFPS = () => {
      if (!fpsEnabled) { requestAnimationFrame(updateFPS); return; }
      frames++;
      const now = performance.now();
      if (now - last >= 1000) {
        document.getElementById("fps-value").textContent = frames;
        frames = 0; last = now;
      }
      requestAnimationFrame(updateFPS);
    };
    document.getElementById("fps-counter").onclick = () => {
      fpsEnabled = !fpsEnabled;
      document.getElementById("fps-counter").style.borderColor = fpsEnabled ? "#22c55e" : "#666";
    };

    // Leaderboard
    const updateLeaderboard = async () => {
      try {
        const res = await fetch(FIREBASE_URL);
        const data = await res.json();
        if (!data) { document.getElementById("leaderboard-content").innerHTML = "Aucun record"; return; }
        const entries = Object.values(data).sort((a,b)=>b.time-a.time).slice(0,3);
        const html = entries.map((e,i) => 
          `<div style="display:flex;align-items:center;gap:12px;margin:8px 0;">
            <div style="width:30px;height:30px;background:#ffd700;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#333;font-weight:bold;">${i+1}</div>
            <img src="${e.avatar||'https://cdn.discordapp.com/embed/avatars/0.png'}" width="30" height="30" style="border-radius:50%;">
            <div><b>${e.name}</b><br><small>${Math.floor(e.time/60)}:${(e.time%60).toString().padStart(2,"0")}</small></div>
          </div>`).join("");
        document.getElementById("leaderboard-content").innerHTML = html || "Aucun record";
      } catch(e) { document.getElementById("leaderboard-content").innerHTML = "Erreur réseau"; }
    };

    // NO COIN Logic (simplifiée mais très efficace)
    let gameRunning = false, runStart = 0, noCoinTime = 0, bestNoCoin = 0, startCoins = 0;
    const sendRecord = async (time) => {
      const name = localStorage.getItem("mynvo-name") || prompt("Ton pseudo pour le leaderboard ?", "Joueur") || "Anonyme";
      if (name) localStorage.setItem("mynvo-name", name);
      await fetch(FIREBASE_URL.replace(".json",".json"), {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({name, avatar: "https://cdn.discordapp.com/embed/avatars/0.png", time, timestamp: Date.now()})
      });
      updateLeaderboard();
    };

    const gameLoop = () => {
      const scoreEls = [...document.querySelectorAll("iframe")[0]?.contentDocument?.querySelectorAll("div,span") || []]
        .filter(el => /^\d+$/.test(el.textContent.trim()) && parseInt(el.textContent) < 999999);
      if (scoreEls.length === 0) return requestAnimationFrame(gameLoop);

      const coins = parseInt(scoreEls[0].textContent);
      if (!gameRunning && coins > 10) {
        gameRunning = true; runStart = Date.now(); startCoins = coins;
        document.getElementById("coin-indicator").style.opacity = 1;
      }
      if (gameRunning) {
        const elapsed = Math.floor((Date.now() - runStart)/1000);
        document.getElementById("run-timer").textContent = `${Math.floor(elapsed/60)}:${(elapsed%60).toString().padStart(2,"0")}`;
        if (coins === startCoins && elapsed > bestNoCoin) {
          bestNoCoin = elapsed;
          document.getElementById("best-time").textContent = `${Math.floor(bestNoCoin/60)}:${(bestNoCoin%60).toString().padStart(2,"0")}`;
        }
        if (coins > startCoins && bestNoCoin >= 5) {
          document.getElementById("coin-indicator").innerHTML = `PIÈCE COLLECTÉE !<br><small>Temps NO COIN: ${Math.floor(bestNoCoin/60)}:${(bestNoCoin%60).toString().padStart(2,"0")}</small>`;
          document.getElementById("coin-indicator").style.borderColor = "#ef4444";
          sendRecord(bestNoCoin);
          setTimeout(() => { document.getElementById("coin-indicator").style.opacity = 0; }, 4000);
          gameRunning = false;
        }
      }
      requestAnimationFrame(gameLoop);
    };

    // Init
    function initMynvo() {
      loadKeys();
      updateFPS();
      updateLeaderboard();
      setInterval(updateLeaderboard, 8000);
      gameLoop();

      // Ouvrir config touches sur clic droit du bandeau
      document.getElementById("key-display").ondblclick = () => {
        document.getElementById("cfg-up").value = keys.up;
        document.getElementById("cfg-down").value = keys.down;
        document.getElementById("cfg-left").value = keys.left;
        document.getElementById("cfg-right").value = keys.right;
        document.getElementById("cfg-jump").value = keys.jump === " " ? "" : keys.jump;
        document.getElementById("key-config").classList.add("show");
      };
    }
  </script>
</body>
</html>
