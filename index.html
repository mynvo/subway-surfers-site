<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subway Surfers by Mynvo</title>
  <style>
    :root {
      --primary: #7c62dc;
      --bg-dark: #0a0a0a;
      --bg-card: rgba(30, 30, 40, 0.8);
      --text-light: #f0f0f0;
      --success: #00cc66;
      --danger: #ff4444;
      --warning: #ffaa00;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    header {
      background: rgba(124, 98, 220, 0.15);
      backdrop-filter: blur(12px);
      padding: 18px 40px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      border-bottom: 2px solid var(--primary);
    }
    
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 34px;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    
    .logo span { color: var(--primary); }
    
    .nav-links {
      display: flex;
      gap: 24px;
    }
    
    .nav-links a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
      cursor: pointer;
    }
    
    .nav-links a:hover { color: var(--primary); }
    
    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 120px 20px 40px;
    }
    
    .game-container {
      width: 100%;
      max-width: 1350px;
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      border-radius: 28px;
      padding: 40px;
      border: 2px solid var(--primary);
    }
    
    .game-frame {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      border: 2px solid var(--primary);
    }
    
    iframe {
      width: 100%;
      height: 720px;
      border: none;
      background: #000000;
      display: block;
    }
    
    /* Bouton plein √©cran sur l'iframe */
    .fs-button {
      position: absolute;
      top: 15px;
      right: 15px;
      z-index: 200;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid var(--primary);
      color: #fff;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .fs-button:hover {
      background: var(--primary);
      color: #000;
    }
    
    /* OVERLAYS - FORC√âS PARTOUT */
    #fps-overlay, #timer-overlay, #top3-overlay {
      position: fixed !important;
      z-index: 2147483647 !important;
      pointer-events: none !important;
      font-family: 'Courier New', monospace !important;
    }
    
    :fullscreen #fps-overlay,
    :fullscreen #timer-overlay,
    :fullscreen #top3-overlay,
    :-webkit-full-screen #fps-overlay,
    :-webkit-full-screen #timer-overlay,
    :-webkit-full-screen #top3-overlay {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    #fps-overlay {
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: var(--primary);
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      border: 2px solid var(--primary);
      box-shadow: 0 0 15px rgba(124, 98, 220, 0.5);
    }
    
    #timer-overlay {
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      padding: 8px 14px;
      border-radius: 10px;
      border: 2px solid var(--primary);
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 0 15px rgba(124, 98, 220, 0.5);
    }
    
    #timer-overlay.running {
      border-color: var(--success);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 15px rgba(0, 204, 102, 0.5); }
      50% { box-shadow: 0 0 25px rgba(0, 204, 102, 0.8); }
    }
    
    .timer-display {
      font-size: 18px;
      font-weight: bold;
      color: var(--success);
    }
    
    .timer-status {
      font-size: 10px;
      color: #aaa;
      margin-top: 2px;
    }
    
    #top3-overlay {
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.95);
      color: #fff;
      padding: 14px 20px;
      border-radius: 12px;
      border: 2px solid var(--primary);
      font-size: 13px;
      min-width: 260px;
      box-shadow: 0 0 20px rgba(124, 98, 220, 0.5);
    }
    
    #top3-overlay .title {
      color: var(--primary);
      font-size: 15px;
      font-weight: 900;
      margin-bottom: 10px;
      text-align: center;
    }
    
    #top3-overlay .player {
      margin: 6px 0;
      padding: 6px;
      border-radius: 6px;
      background: rgba(124, 98, 220, 0.1);
    }
    
    #top3-overlay .player.first {
      color: var(--primary);
      font-weight: 700;
      font-size: 14px;
      background: rgba(124, 98, 220, 0.2);
    }
    
    /* Menu param√®tres */
    #settings-menu {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.95);
      border: 2px solid var(--primary);
      border-radius: 12px;
      padding: 14px 18px;
      z-index: 999999;
      color: #fff;
      min-width: 240px;
      box-shadow: 0 0 20px rgba(124, 98, 220, 0.5);
      display: none;
    }
    
    #settings-menu.visible {
      display: block;
    }
    
    .menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--primary);
    }
    
    .menu-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--primary);
    }
    
    .close-btn {
      background: var(--danger);
      border: none;
      color: #fff;
      font-weight: 700;
      border-radius: 6px;
      padding: 4px 10px;
      cursor: pointer;
    }
    
    .menu-btn {
      width: 100%;
      padding: 8px 10px;
      background: #111;
      border: 2px solid var(--primary);
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      margin-top: 8px;
      font-size: 14px;
    }
    
    .menu-btn:hover {
      background: var(--primary);
      color: #000;
    }
    
    .menu-btn.gold {
      background: linear-gradient(135deg, #ffd700, #ffaa00);
      color: #000;
      border: none;
      font-weight: 700;
    }
    
    .menu-btn.gold:hover {
      transform: scale(1.03);
    }
    
    .notification {
      position: fixed;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(20, 20, 30, 0.95);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
      z-index: 2147483646;
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
      font-size: 14px;
    }
    
    .notification.show { opacity: 1; }
    
    footer {
      text-align: center;
      padding: 25px;
      font-size: 15px;
      opacity: 0.85;
    }

    @media (max-width: 768px) {
      iframe { height: 400px; }
      #fps-overlay, #timer-overlay, #top3-overlay {
        font-size: 12px;
        padding: 6px 10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        Subway<span>Surfers</span> by <span>Mynvo</span>
      </div>
      <div class="nav-links">
        <a id="play-link">Jouer</a>
        <a id="settings-link">Param√®tres</a>
        <a href="https://discord.gg/bQTtDXmF" target="_blank">Discord</a>
      </div>
    </div>
  </header>

  <main>
    <div class="game-container">
      <div class="game-frame">
        <button class="fs-button" id="fs-btn">‚§¢ Plein √©cran</button>
        <iframe id="game-iframe" src="./game/" allowfullscreen allow="autoplay; fullscreen *"></iframe>
      </div>
    </div>
  </main>

  <div id="fps-overlay">üéÆ FPS: <span id="fps-value">60</span></div>

  <div id="timer-overlay">
    <div class="timer-display"><span id="timer-value">00:00.00</span></div>
    <div class="timer-status">F1=Start F2=Stop F3=Reset</div>
  </div>

  <div id="top3-overlay">
    <div class="title">üèÜ TOP 3 NO COIN</div>
    <div class="player first">ü•á Mynvo ‚Äì 13:27</div>
    <div class="player">ü•à Le_A ‚Äì 11:51</div>
    <div class="player">ü•â .... ‚Äì 0:00</div>
  </div>

  <div id="settings-menu">
    <div class="menu-header">
      <div class="menu-title">‚öôÔ∏è Param√®tres</div>
      <button class="close-btn" id="close-menu">‚úñ</button>
    </div>
    <button class="menu-btn gold" id="give-btn">üí∞ Give Piece & Keys</button>
    <button class="menu-btn" id="fps-toggle">üìä Toggle FPS</button>
    <button class="menu-btn" id="top3-toggle">üèÜ Toggle TOP3</button>
  </div>

  <footer>Subway Surfers by Mynvo ¬© 2023</footer>

  <script>
    const iframe = document.getElementById('game-iframe');
    let timerInterval = null;
    let timerStart = 0;
    let timerElapsed = 0;
    let timerActive = false;

üí∞ 999,999,999 pi√®ces & cl√©s donn√©es!', 'success');
                        };
                      }
                    }
                  } catch(e) {}
                });
              };
            } catch(e) {
              console.warn('Erreur store:', e);
            }
          });
        };
        
        request.onerror = () => {
          console.warn('‚ùå IndexedDB non accessible');
          showNotification('‚ö†Ô∏è Rechargez la page puis r√©essayez', 'warning');
        };
        
      } catch (error) {
        console.error('‚ùå Erreur Give:', error);
      }
    }

    // ============= TOUCHES ZQSD (ULTRA FORC√â) =============
    const keyMapping = {
      'z': { key: 'ArrowUp', code: 'ArrowUp', keyCode: 38 },
      'q': { key: 'ArrowLeft', code: 'ArrowLeft', keyCode: 37 },
      's': { key: 'ArrowDown', code: 'ArrowDown', keyCode: 40 },
      'd': { key: 'ArrowRight', code: 'ArrowRight', keyCode: 39 },
      ' ': { key: ' ', code: 'Space', keyCode: 32 }
    };

    function setupZQSD() {
      const sendToIframe = (type, mapped) => {
        try {
          const iframeWin = iframe.contentWindow;
          const iframeDoc = iframe.contentDocument;
          
          const event = new KeyboardEvent(type, {
            key: mapped.key,
            code: mapped.code,
            keyCode: mapped.keyCode,
            which: mapped.keyCode,
            bubbles: true,
            cancelable: true,
            composed: true
          });
          
          // Multi-dispatch
          if (iframeDoc) iframeDoc.dispatchEvent(event);
          if (iframeWin) iframeWin.dispatchEvent(event);
          if (iframeDoc && iframeDoc.body) iframeDoc.body.dispatchEvent(event);
        } catch(e) {
          console.warn('Dispatch error:', e);
        }
      };

      ['keydown', 'keyup'].forEach(type => {
        const handler = (e) => {
          const key = e.key ? e.key.toLowerCase() : '';
          const mapped = keyMapping[key];
          
          if (mapped) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            
            sendToIframe(type, mapped);
            console.log(`üéÆ ${type}: ${key} ‚Üí ${mapped.key}`);
          }
        };
        
        // Capturer PARTOUT
        document.addEventListener(type, handler, { capture: true, passive: false });
        window.addEventListener(type, handler, { capture: true, passive: false });
      });
      
      // Auto-focus permanent
      setInterval(() => {
        if (document.activeElement !== iframe) {
          iframe.focus();
        }
      }, 100);
      
      console.log('‚úÖ ZQSD Ultra Forc√© activ√©');
    }

    // ============= PLEIN √âCRAN SUR IFRAME =============
    document.getElementById('fs-btn').addEventListener('click', () => {
      try {
        if (iframe.requestFullscreen) {
          iframe.requestFullscreen();
        } else if (iframe.webkitRequestFullscreen) {
          iframe.webkitRequestFullscreen();
        }
        showNotification('‚§¢ Mode plein √©cran activ√©', 'info');
      } catch(e) {
        console.error('Fullscreen error:', e);
      }
    });

    // ============= TIMER =============
    function setupTimer() {
      document.addEventListener('keydown', (e) => {
        if (e.key === 'F1') {
          e.preventDefault();
          if (!timerActive) startTimer();
        }
        else if (e.key === 'F2') {
          e.preventDefault();
          if (timerActive) stopTimer();
        }
        else if (e.key === 'F3') {
          e.preventDefault();
          resetTimer();
        }
      });
    }

    function startTimer() {
      timerStart = Date.now() - timerElapsed;
      timerActive = true;
      document.getElementById('timer-overlay').classList.add('running');
      
      timerInterval = setInterval(() => {
        timerElapsed = Date.now() - timerStart;
        document.getElementById('timer-value').textContent = formatTime(timerElapsed);
      }, 10);
      
      showNotification('‚ñ∂Ô∏è Timer d√©marr√©', 'success');
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerActive = false;
      document.getElementById('timer-overlay').classList.remove('running');
      showNotification('‚è∏Ô∏è Timer arr√™t√©', 'warning');
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timerActive = false;
      timerElapsed = 0;
      document.getElementById('timer-value').textContent = '00:00.00';
      document.getElementById('timer-overlay').classList.remove('running');
      showNotification('üîÑ Timer reset', 'info');
    }

    function formatTime(ms) {
      const m = Math.floor(ms / 60000);
      const s = Math.floor((ms % 60000) / 1000);
      const cs = Math.floor((ms % 1000) / 10);
      return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}.${String(cs).padStart(2, '0')}`;
    }

    // ============= FPS =============
    let fpsFrames = 0;
    let fpsLast = performance.now();
    
    function updateFPS() {
      fpsFrames++;
      const now = performance.now();
      
      if (now - fpsLast >= 1000) {
        const fps = Math.round((fpsFrames * 1000) / (now - fpsLast));
        document.getElementById('fps-value').textContent = fps;
        
        const el = document.getElementById('fps-overlay');
        if (fps >= 55) {
          el.style.color = '#7c62dc';
          el.style.borderColor = '#7c62dc';
        } else if (fps >= 30) {
          el.style.color = '#f59e0b';
          el.style.borderColor = '#f59e0b';
        } else {
          el.style.color = '#ef4444';
          el.style.borderColor = '#ef4444';
        }
        
        fpsFrames = 0;
        fpsLast = now;
      }
      
      requestAnimationFrame(updateFPS);
    }

    // ============= MENU PARAM√àTRES =============
    document.getElementById('settings-link').addEventListener('click', () => {
      document.getElementById('settings-menu').classList.toggle('visible');
    });

    document.getElementById('close-menu').addEventListener('click', () => {
      document.getElementById('settings-menu').classList.remove('visible');
    });

    document.getElementById('give-btn').addEventListener('click', () => {
      giveResources();
    });

    document.getElementById('fps-toggle').addEventListener('click', () => {
      const fps = document.getElementById('fps-overlay');
      fps.style.display = fps.style.display === 'none' ? 'block' : 'none';
      showNotification('üìä FPS toggled', 'info');
    });

    document.getElementById('top3-toggle').addEventListener('click', () => {
      const top3 = document.getElementById('top3-overlay');
      top3.style.display = top3.style.display === 'none' ? 'block' : 'none';
      showNotification('üèÜ TOP3 toggled', 'info');
    });

    // ============= NOTIFICATIONS =============
    function showNotification(msg, type = 'info') {
      const notif = document.createElement('div');
      notif.className = 'notification';
      notif.textContent = msg;
      
      const colors = { success: '#00cc66', warning: '#ffaa00', error: '#ff4444', info: '#7c62dc' };
      notif.style.borderLeftColor = colors[type];
      
      document.body.appendChild(notif);
      setTimeout(() => notif.classList.add('show'), 10);
      setTimeout(() => {
        notif.classList.remove('show');
        setTimeout(() => notif.remove(), 300);
      }, 3500);
    }

    // ============= INIT =============
    document.addEventListener('DOMContentLoaded', () => {
      setupZQSD();
      setupTimer();
      updateFPS();
      
      console.log('%cüéÆ MYNVO READY', 'color:#7c62dc;font-weight:bold;font-size:16px');
      console.log('%c‚å®Ô∏è  ZQSD Always Active', 'color:#7c62dc');
      console.log('%c‚è±Ô∏è  F1/F2/F3 Timer', 'color:#7c62dc');
      console.log('%cüí∞ IndexedDB Give', 'color:#00cc66');
      
      setTimeout(() => {
        showNotification('üéÆ Syst√®me MYNVO activ√©! Touches ZQSD actives', 'success');
      }, 1000);
    });

    document.getElementById('play-link').addEventListener('click', () => {
      document.querySelector('.game-container').scrollIntoView({ behavior: 'smooth' });
      iframe.focus();
    });

    // Focus iframe au chargement
    iframe.addEventListener('load', () => {
      console.log('‚úÖ Jeu charg√©');
      iframe.focus();
    });
  </script>
</body>
</html>
